<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:MaterialClient.ViewModels"
        xmlns:converters="using:MaterialClient.Converters"
        mc:Ignorable="d"
        x:Class="MaterialClient.Views.ManualMatchEditWindow"
        x:DataType="vm:ManualMatchEditWindowViewModel"
        Title="订单匹配确认"
        Width="755"
        Height="768"
        CanResize="False"
        WindowStartupLocation="CenterOwner"
        SystemDecorations="None"
        Background="White"
        Icon="/Assets/fd-ico.ico">

    <Window.Resources>
        <converters:CarNullOrEmptyImageConverter x:Key="CarNullOrEmptyImageConverter" />
    </Window.Resources>

    <Border BorderBrush="LightGray" BorderThickness="1">
        <Grid RowDefinitions="50,*">

            <!-- 标题栏 -->
            <Grid Grid.Row="0" Background="#6498FE">
                <TextBlock Text="订单匹配确认"
                           FontSize="14"
                           Foreground="White"
                           VerticalAlignment="Center"
                           Margin="15,0,0,0" />
                <Button Content="✕"
                        Classes="transparent-button"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center"
                        FontSize="20"
                        Foreground="White"
                        Width="40"
                        Height="35"
                        Click="OnCloseButtonClick"
                        Cursor="Hand" />
            </Grid>

            <!-- 内容区域 -->
            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
                <StackPanel Margin="10" Spacing="10">

                    <!-- 第一行：车牌号、供应商 -->
                    <Grid ColumnDefinitions="*,*">
                        <Grid Grid.Column="0" ColumnDefinitions="80,*" Margin="5">
                            <TextBlock Text="车牌号：" FontSize="13" VerticalAlignment="Center" Foreground="#333" />
                            <TextBox Grid.Column="1"
                                     Watermark="请输入车牌号"
                                     Height="30"
                                     Text="{Binding PlateNumber, Mode=TwoWay}" />
                        </Grid>
                        <Grid Grid.Column="1" ColumnDefinitions="80,*" Margin="5">
                            <TextBlock Text="供应商：" FontSize="13" VerticalAlignment="Center" Foreground="#333" />
                            <ComboBox Grid.Column="1"
                                      PlaceholderText="请选择供应商"
                                      Height="30"
                                      HorizontalAlignment="Stretch"
                                      ItemsSource="{Binding Providers}"
                                      SelectedItem="{Binding SelectedProvider, Mode=TwoWay}"
                                      DisplayMemberBinding="{Binding ProviderName}" />
                        </Grid>
                    </Grid>

                    <!-- 第二行：称毛时间、称皮时间 -->
                    <Grid ColumnDefinitions="*,*">
                        <Grid Grid.Column="0" ColumnDefinitions="80,*" Margin="5">
                            <TextBlock Text="称毛时间：" FontSize="13" VerticalAlignment="Center" Foreground="#333" />
                            <TextBox Grid.Column="1"
                                     Height="30"
                                     IsEnabled="False"
                                     Text="{Binding GrossWeightTime, StringFormat='{}{0:yyyy-MM-dd HH:mm:ss}'}" />
                        </Grid>
                        <Grid Grid.Column="1" ColumnDefinitions="80,*" Margin="5">
                            <TextBlock Text="称皮时间：" FontSize="13" VerticalAlignment="Center" Foreground="#333" />
                            <TextBox Grid.Column="1"
                                     Height="30"
                                     IsEnabled="False"
                                     Text="{Binding TareWeightTime, StringFormat='{}{0:yyyy-MM-dd HH:mm:ss}'}" />
                        </Grid>
                    </Grid>

                    <!-- 第三行：毛重、皮重 -->
                    <Grid ColumnDefinitions="*,*">
                        <Grid Grid.Column="0" ColumnDefinitions="80,*" Margin="5">
                            <TextBlock Text="毛重（吨）：" FontSize="13" VerticalAlignment="Center" Foreground="#333" />
                            <TextBox Grid.Column="1"
                                     Height="30"
                                     IsEnabled="False"
                                     Text="{Binding GrossWeight, StringFormat='{}{0:F2}'}" />
                        </Grid>
                        <Grid Grid.Column="1" ColumnDefinitions="80,*" Margin="5">
                            <TextBlock Text="皮重（吨）：" FontSize="13" VerticalAlignment="Center" Foreground="#333" />
                            <TextBox Grid.Column="1"
                                     Height="30"
                                     IsEnabled="False"
                                     Text="{Binding TareWeight, StringFormat='{}{0:F2}'}" />
                        </Grid>
                    </Grid>

                    <!-- 第四行：净重、材料类别 -->
                    <Grid ColumnDefinitions="*,*">
                        <Grid Grid.Column="0" ColumnDefinitions="80,*" Margin="5">
                            <TextBlock Text="净重（吨）：" FontSize="13" VerticalAlignment="Center" Foreground="#333" />
                            <TextBox Grid.Column="1"
                                     Height="30"
                                     IsEnabled="False"
                                     Text="{Binding NetWeight, StringFormat='{}{0:F2}'}" />
                        </Grid>
                        <Grid Grid.Column="1" ColumnDefinitions="80,*" Margin="5">
                            <TextBlock Text="材料类别：" FontSize="13" VerticalAlignment="Center" Foreground="#333" />
                            <TextBox Grid.Column="1"
                                     Height="30"
                                     IsEnabled="False"
                                     Text="{Binding MaterialCategory}" />
                        </Grid>
                    </Grid>

                    <!-- 备注 -->
                    <Grid ColumnDefinitions="80,*" Margin="5">
                        <TextBlock Text="备注：" FontSize="13" VerticalAlignment="Top" Foreground="#333" Margin="0,5,0,0" />
                        <TextBox Grid.Column="1"
                                 Height="50"
                                 TextWrapping="Wrap"
                                 AcceptsReturn="True"
                                 Watermark="请输入备注"
                                 Text="{Binding Remark, Mode=TwoWay}" />
                    </Grid>

                    <!-- 材料明细区域 -->
                    <Border BorderBrush="LightGray" BorderThickness="1" CornerRadius="4" Padding="10" Margin="5">
                        <StackPanel Spacing="8">
                            <!-- 材料明细标题行 -->
                            <Grid ColumnDefinitions="*,*">
                                <Grid Grid.Column="0" ColumnDefinitions="80,*">
                                    <TextBlock Text="材料明细：" FontSize="13" VerticalAlignment="Center" Foreground="#333" />
                                    <ComboBox Grid.Column="1"
                                              PlaceholderText="请选择材料"
                                              Height="30"
                                              HorizontalAlignment="Stretch"
                                              ItemsSource="{Binding Materials}"
                                              SelectedItem="{Binding SelectedMaterial, Mode=TwoWay}"
                                              DisplayMemberBinding="{Binding Name}" />
                                </Grid>
                                <Grid Grid.Column="1" ColumnDefinitions="80,*">
                                    <TextBlock Text="规格型号：" FontSize="13" VerticalAlignment="Center" Foreground="#333" />
                                    <TextBox Grid.Column="1"
                                             Height="30"
                                             IsEnabled="False"
                                             Text="{Binding Specifications}" />
                                </Grid>
                            </Grid>

                            <!-- 单位、换算系数 -->
                            <Grid ColumnDefinitions="*,*">
                                <Grid Grid.Column="0" ColumnDefinitions="80,*">
                                    <TextBlock Text="单位：" FontSize="13" VerticalAlignment="Center" Foreground="#333" />
                                    <ComboBox Grid.Column="1"
                                              PlaceholderText="请选择单位"
                                              Height="30"
                                              HorizontalAlignment="Stretch"
                                              ItemsSource="{Binding MaterialUnits}"
                                              SelectedItem="{Binding SelectedMaterialUnit, Mode=TwoWay}"
                                              DisplayMemberBinding="{Binding UnitName}" />
                                </Grid>
                                <Grid Grid.Column="1" ColumnDefinitions="80,*">
                                    <TextBlock Text="换算系数：" FontSize="13" VerticalAlignment="Center" Foreground="#333" />
                                    <TextBox Grid.Column="1"
                                             Height="30"
                                             IsEnabled="False"
                                             Text="{Binding ConversionRate, StringFormat='{}{0:F2}'}" />
                                </Grid>
                            </Grid>

                            <!-- 运单数量、运单重量 -->
                            <Grid ColumnDefinitions="*,*">
                                <Grid Grid.Column="0" ColumnDefinitions="80,*">
                                    <TextBlock Text="运单数量：" FontSize="13" VerticalAlignment="Center" Foreground="#333" />
                                    <TextBox Grid.Column="1"
                                             Height="30"
                                             Text="{Binding WaybillQuantity, Mode=TwoWay}" />
                                </Grid>
                                <Grid Grid.Column="1" ColumnDefinitions="80,*">
                                    <TextBlock Text="运单重量：" FontSize="13" VerticalAlignment="Center" Foreground="#333" />
                                    <TextBox Grid.Column="1"
                                             Height="30"
                                             IsEnabled="False"
                                             Text="{Binding WaybillWeight, StringFormat='{}{0:F2}'}" />
                                </Grid>
                            </Grid>

                            <!-- 删除按钮 -->
                            <Button Content="删除"
                                    Classes="danger-button"
                                    HorizontalAlignment="Right"
                                    CornerRadius="4"
                                    Padding="16,6"
                                    Margin="0,5,0,0"
                                    Command="{Binding DeleteMaterialCommand}" />
                        </StackPanel>
                    </Border>

                    <!-- 添加材料按钮 -->
                    <Button Content="添加材料"
                            Classes="outline-button"
                            HorizontalAlignment="Center"
                            CornerRadius="4"
                            Padding="24,8"
                            Margin="0,5,0,10"
                            Command="{Binding AddMaterialCommand}" />

                    <!-- 进场照片/出场照片区域 -->
                    <Grid ColumnDefinitions="*,*" Margin="0,10,0,0">
                        <!-- 进场照片 -->
                        <StackPanel Grid.Column="0" Spacing="5">
                            <TextBlock Text="进场照片" FontSize="13" Foreground="#333" Margin="5,0,0,5" />
                            <ItemsControl ItemsSource="{Binding EntryPhotos}" Width="340" Height="200" Margin="5">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <UniformGrid Rows="2" Columns="2" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="#E5E7EB" Margin="2" CornerRadius="4">
                                            <Image
                                                Source="{Binding ., Converter={StaticResource CarNullOrEmptyImageConverter}}"
                                                Stretch="UniformToFill" />
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            <!-- 如果没有照片时显示占位 -->
                            <UniformGrid Rows="2" Columns="2" Width="340" Height="200" Margin="5"
                                         IsVisible="{Binding EntryPhotos.Count, Converter={x:Static ObjectConverters.IsNull}}">
                                <Border Background="#E5E7EB" Margin="2" CornerRadius="4" />
                                <Border Background="#E5E7EB" Margin="2" CornerRadius="4" />
                                <Border Background="#E5E7EB" Margin="2" CornerRadius="4" />
                                <Border Background="#E5E7EB" Margin="2" CornerRadius="4" />
                            </UniformGrid>
                        </StackPanel>

                        <!-- 出场照片 -->
                        <StackPanel Grid.Column="1" Spacing="5">
                            <TextBlock Text="出场照片" FontSize="13" Foreground="#333" Margin="5,0,0,5" />
                            <ItemsControl ItemsSource="{Binding ExitPhotos}" Width="340" Height="200" Margin="5">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <UniformGrid Rows="2" Columns="2" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="#E5E7EB" Margin="2" CornerRadius="4">
                                            <Image
                                                Source="{Binding ., Converter={StaticResource CarNullOrEmptyImageConverter}}"
                                                Stretch="UniformToFill" />
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            <!-- 如果没有照片时显示占位 -->
                            <UniformGrid Rows="2" Columns="2" Width="340" Height="200" Margin="5"
                                         IsVisible="{Binding ExitPhotos.Count, Converter={x:Static ObjectConverters.IsNull}}">
                                <Border Background="#E5E7EB" Margin="2" CornerRadius="4" />
                                <Border Background="#E5E7EB" Margin="2" CornerRadius="4" />
                                <Border Background="#E5E7EB" Margin="2" CornerRadius="4" />
                                <Border Background="#E5E7EB" Margin="2" CornerRadius="4" />
                            </UniformGrid>
                        </StackPanel>
                    </Grid>

                    <!-- 运单照片区域 -->
                    <!--
                    <StackPanel Margin="0,10,0,0" Spacing="5">
                        <TextBlock Text="运单照片" FontSize="13" Foreground="#333" Margin="5,0,0,5" />
                        <Grid ColumnDefinitions="Auto,Auto,*">
                            拍照预览区
                            <Border Grid.Column="0"
                                    Background="#E5E7EB"
                                    Width="260"
                                    Height="180"
                                    CornerRadius="4"
                                    Margin="5">
                                <Image
                                    Source="{Binding TicketPhoto, Converter={StaticResource CarNullOrEmptyImageConverter}}"
                                    Stretch="UniformToFill" />
                            </Border>
                            视频预览区（用静态占位）
                            <Border Grid.Column="1"
                                    Background="#E5E7EB"
                                    Width="260"
                                    Height="180"
                                    CornerRadius="4"
                                    Margin="5">
                                <TextBlock Text="视频预览"
                                           FontSize="14"
                                           Foreground="#999"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center" />
                            </Border>
                            拍照按钮
                            <Button Grid.Column="2"
                                    Content="拍照"
                                    Classes="primary-button"
                                    VerticalAlignment="Top"
                                    CornerRadius="4"
                                    Padding="24,8"
                                    Margin="10,0,0,0"
                                    Command="{Binding TakePhotoCommand}" />
                        </Grid>
                    </StackPanel>
                    -->

                    <!-- 底部按钮 -->
                    <Grid ColumnDefinitions="*,*" Margin="0,20,0,10">
                        <Button Grid.Column="0"
                                Content="取消"
                                Classes="secondary-button"
                                HorizontalAlignment="Right"
                                CornerRadius="4"
                                Padding="24,8"
                                Margin="0,0,20,0"
                                Click="OnCloseButtonClick" />
                        <Button Grid.Column="1"
                                Content="确定"
                                Classes="primary-button"
                                HorizontalAlignment="Left"
                                CornerRadius="4"
                                Padding="24,8"
                                Margin="20,0,0,0"
                                Click="OnConfirmButtonClick" />
                    </Grid>
                </StackPanel>
            </ScrollViewer>
        </Grid>
    </Border>
</Window>