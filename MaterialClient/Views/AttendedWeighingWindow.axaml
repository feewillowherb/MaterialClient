<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:entities="using:MaterialClient.Common.Entities"
        xmlns:vm="using:MaterialClient.ViewModels"
        xmlns:sys="clr-namespace:System;assembly=System.Runtime"
        xmlns:views="using:MaterialClient.Views"
        x:Class="MaterialClient.Views.AttendedWeighingWindow"
        x:DataType="vm:AttendedWeighingViewModel"
        Title="有人值守"
        Width="1440" Height="900"
        WindowStartupLocation="CenterScreen">
  
  <Grid RowDefinitions="Auto,Auto,*,Auto" ColumnDefinitions="*">
    
    <!-- Top Blue Header Bar -->
    <Border Grid.Row="0" Background="#4169E1" Padding="16,12">
      <Grid ColumnDefinitions="Auto,*,Auto">
        <!-- Logo and Title -->
        <StackPanel Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
          <Image Source="/Assets/Indexlogo.png" Width="210" Height="32" Stretch="Uniform"/>
        </StackPanel>
        
        <!-- Menu Items (Center) -->
        <StackPanel Grid.Column="1" 
                    Orientation="Horizontal" 
                    Spacing="32" 
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center">
          <Button Content="数据管理" 
                  Foreground="White" 
                  Background="Transparent"
                  BorderThickness="0"
                  Padding="8,4"/>
          <Button Content="系统设置" 
                  Foreground="White" 
                  Background="Transparent"
                  BorderThickness="0"
                  Padding="8,4"
                  Command="{Binding OpenSettingsCommand}"/>
          <Button Content="项目信息" 
                  Foreground="White" 
                  Background="Transparent"
                  BorderThickness="0"
                  Padding="8,4"/>
          <Button Content="数据同步" 
                  Foreground="White" 
                  Background="Transparent"
                  BorderThickness="0"
                  Padding="8,4"/>
        </StackPanel>
        
      </Grid>
    </Border>

    <!-- Blue Gradient Weight Display Area -->
    <Grid Grid.Row="1" Background="#4A85F9">
      <!-- Background Image Layer -->
      <Border>
        <Border.Background>
          <ImageBrush Source="/Assets/Indexbanner.png" 
                      Stretch="UniformToFill"
                      AlignmentX="Center"
                      AlignmentY="Center"/>
        </Border.Background>
      </Border>
      
      <!-- Content Layer with Margin -->
      <Grid ColumnDefinitions="Auto,*,Auto" 
            Margin="24,32"
            HorizontalAlignment="Stretch" 
            VerticalAlignment="Stretch">
        <!-- Province Selector -->
        <Border Background="#5A7FE6" 
                CornerRadius="8" 
                Padding="20,12"
                VerticalAlignment="Center">
          <TextBlock Text="{Binding MostFrequentPlateNumber, TargetNullValue='--'}" 
                     Foreground="White" 
                     FontSize="16"/>
        </Border>
        
        <!-- Weight Display Center -->
        <Grid Grid.Column="1" 
              HorizontalAlignment="Center"
              ColumnDefinitions="Auto,Auto,Auto">
          <!-- Delivery Type Toggle -->
          <Border Background="White" 
                  CornerRadius="8" 
                  Padding="2"
                  VerticalAlignment="Center"
                  Margin="0,0,32,0">
            <StackPanel Orientation="Horizontal" Spacing="2">
              <Button Content="收料" 
                      Classes="delivery-button"
                      Classes.selected="{Binding IsReceiving}"
                      Foreground="#333"
                      BorderThickness="0"
                      CornerRadius="6"
                      Padding="32,8"
                      FontSize="16"
                      Command="{Binding SetReceivingCommand}">
                <Button.Styles>
                  <Style Selector="Button.delivery-button">
                    <Setter Property="Background" Value="Transparent"/>
                  </Style>
                  <Style Selector="Button.delivery-button.selected">
                    <Setter Property="Background" Value="#E0E7FF"/>
                  </Style>
                </Button.Styles>
              </Button>
              <Button Content="发料" 
                      Classes="delivery-button"
                      Classes.selected="{Binding !IsReceiving}"
                      Foreground="#333"
                      BorderThickness="0"
                      CornerRadius="6"
                      Padding="32,8"
                      FontSize="16"
                      Command="{Binding SetSendingCommand}">
                <Button.Styles>
                  <Style Selector="Button.delivery-button">
                    <Setter Property="Background" Value="Transparent"/>
                  </Style>
                  <Style Selector="Button.delivery-button.selected">
                    <Setter Property="Background" Value="#E0E7FF"/>
                  </Style>
                </Button.Styles>
              </Button>
            </StackPanel>
          </Border>
          
          <!-- Weight Value -->
          <TextBlock Grid.Column="1" 
                     Text="{Binding CurrentWeight, StringFormat='{}{0:F2}'}" 
                     Foreground="White" 
                     FontSize="64" 
                     FontWeight="Bold"
                     VerticalAlignment="Center"
                     Margin="16,0"/>
          
          <!-- Unit -->
          <TextBlock Grid.Column="2" 
                     Text="吨" 
                     Foreground="White" 
                     FontSize="24"
                     VerticalAlignment="Center"
                     Margin="8,0,0,0"/>
        </Grid>
        
        <!-- Right Side Info -->
        <TextBlock Grid.Column="2" 
                   Text="{Binding CurrentWeighingStatusText}" 
                   Foreground="White" 
                   FontSize="18"
                   VerticalAlignment="Center"/>
      </Grid>
    </Grid>

    <!-- Main Content Area (White Background, Three Columns) -->
    <Grid Grid.Row="2" Background="White" ColumnDefinitions="300,*,380" Margin="0">
      
      <!-- Left Column: Record List -->
      <Border Grid.Column="0" 
              Background="#F8F9FA" 
              BorderBrush="#E5E7EB" 
              BorderThickness="0,0,1,0"
              Padding="0">
        <Grid RowDefinitions="Auto,Auto,*">
          <!-- Tab Headers -->
          <Border Grid.Row="0" Background="White" BorderBrush="#E5E7EB" BorderThickness="0,0,0,1">
            <StackPanel Orientation="Horizontal" Spacing="0">
              <Button Content="全部记录" 
                      Classes="tab-button"
                      Classes.active="{Binding IsShowAllRecords}"
                      BorderThickness="0,0,0,3"
                      Padding="24,12"
                      FontSize="14"
                      Command="{Binding ShowAllRecordsCommand}">
                <Button.Styles>
                  <Style Selector="Button.tab-button">
                    <Setter Property="Background" Value="White"/>
                    <Setter Property="Foreground" Value="#666"/>
                    <Setter Property="BorderBrush" Value="Transparent"/>
                  </Style>
                  <Style Selector="Button.tab-button.active">
                    <Setter Property="Background" Value="#F0F7FF"/>
                    <Setter Property="Foreground" Value="#4169E1"/>
                    <Setter Property="BorderBrush" Value="#4169E1"/>
                  </Style>
                </Button.Styles>
              </Button>
              <Button Content="未完成" 
                      Classes="tab-button"
                      Classes.active="{Binding IsShowUnmatched}"
                      BorderThickness="0,0,0,3"
                      Padding="24,12"
                      FontSize="14"
                      Command="{Binding ShowUnmatchedCommand}">
                <Button.Styles>
                  <Style Selector="Button.tab-button">
                    <Setter Property="Background" Value="White"/>
                    <Setter Property="Foreground" Value="#666"/>
                    <Setter Property="BorderBrush" Value="Transparent"/>
                  </Style>
                  <Style Selector="Button.tab-button.active">
                    <Setter Property="Background" Value="#F0F7FF"/>
                    <Setter Property="Foreground" Value="#4169E1"/>
                    <Setter Property="BorderBrush" Value="#4169E1"/>
                  </Style>
                </Button.Styles>
              </Button>
              <Button Content="已完成" 
                      Classes="tab-button"
                      Classes.active="{Binding IsShowCompleted}"
                      BorderThickness="0,0,0,3"
                      Padding="24,12"
                      FontSize="14"
                      Command="{Binding ShowCompletedCommand}">
                <Button.Styles>
                  <Style Selector="Button.tab-button">
                    <Setter Property="Background" Value="White"/>
                    <Setter Property="Foreground" Value="#666"/>
                    <Setter Property="BorderBrush" Value="Transparent"/>
                  </Style>
                  <Style Selector="Button.tab-button.active">
                    <Setter Property="Background" Value="#F0F7FF"/>
                    <Setter Property="Foreground" Value="#4169E1"/>
                    <Setter Property="BorderBrush" Value="#4169E1"/>
                  </Style>
                </Button.Styles>
              </Button>
            </StackPanel>
          </Border>
          
          <!-- Search Box -->
          <Border Grid.Row="1" 
                  Background="White" 
                  Margin="12,12,12,8"
                  Padding="12">
            <Grid RowDefinitions="Auto,Auto,Auto">
            
            <!-- Row 1: 进场时间 + 两个日期框 -->
            <Grid Grid.Row="0" 
                  ColumnDefinitions="Auto,Auto,Auto"
                  Margin="0,0,0,8">
              <TextBlock Text="进场时间" 
                         VerticalAlignment="Center" 
                         Margin="0,0,8,0"
                         FontSize="13"
                         Foreground="#666"/>
              <Border Grid.Column="1" 
                      BorderBrush="#E5E7EB" 
                      BorderThickness="1"
                      CornerRadius="4"
                      Padding="8,4"
                      Margin="0,0,8,0">
                <CalendarDatePicker Width="80"
                                    BorderThickness="0"
                                    Background="Transparent"
                                    FontSize="10"
                                    Watermark="YYYY/MM/DD"/>
              </Border>
              <Border Grid.Column="2" 
                      BorderBrush="#E5E7EB" 
                      BorderThickness="1"
                      CornerRadius="4"
                      Padding="8,4">
                <CalendarDatePicker Width="80"
                                    BorderThickness="0"
                                    Background="Transparent"
                                    FontSize="10"
                                    Watermark="YYYY/MM/DD"/>
              </Border>
            </Grid>
            
            <!-- Row 2: 车牌号码 + 输入框 -->
            <Grid Grid.Row="1" 
                  ColumnDefinitions="Auto,Auto"
                  Margin="0,0,0,8">
              <TextBlock Text="车牌号码" 
                         VerticalAlignment="Center" 
                         Margin="0,0,8,0"
                         FontSize="13"
                         Foreground="#666"/>
              <Border Grid.Column="1" 
                      BorderBrush="#E5E7EB" 
                      BorderThickness="1"
                      CornerRadius="4"
                      Padding="8,4">
                <TextBox Width="100"
                         BorderThickness="0"
                         Background="Transparent"
                         FontSize="13"/>
              </Border>
            </Grid>
            
            <!-- Row 3: 搜索 + 重置按钮 -->
            <Grid Grid.Row="2" 
                  ColumnDefinitions="Auto,Auto">
              <Button Grid.Column="0" 
                      Content="搜索" 
                      Background="#4169E1"
                      Foreground="White"
                      BorderThickness="0"
                      CornerRadius="4"
                      Padding="20,6"
                      FontSize="13"
                      Margin="0,0,4,0"/>
              <Button Grid.Column="1" 
                      Content="重置" 
                      Background="#E5E7EB"
                      Foreground="#333"
                      BorderThickness="0"
                      CornerRadius="4"
                      Padding="20,6"
                      FontSize="13"/>
            </Grid>
            </Grid>
          </Border>
          
          <!-- Record List -->
          <Border Grid.Row="2" Background="White" Margin="12,0,12,12">
            <Grid RowDefinitions="Auto,*,Auto">
              <!-- List Header -->
              <Border Background="#F8F9FA" 
                      BorderBrush="#E5E7EB" 
                      BorderThickness="0,0,0,1"
                      Padding="12,8">
                <Grid ColumnDefinitions="80,*,*">
                  <TextBlock Text="车牌" FontSize="13" FontWeight="SemiBold" Foreground="#666"/>
                  <TextBlock Grid.Column="1" Text="进场时间" FontSize="13" FontWeight="SemiBold" Foreground="#666"/>
                  <TextBlock Grid.Column="2" Text="出场时间" FontSize="13" FontWeight="SemiBold" Foreground="#666"/>
                </Grid>
              </Border>
              
              <!-- Scrollable List - Unmatched Records -->
              <ScrollViewer Grid.Row="1" IsVisible="{Binding IsShowUnmatched}">
                <ItemsControl ItemsSource="{Binding PagedUnmatchedWeighingRecords}">
                  <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="entities:WeighingRecord">
                      <Button Background="Transparent"
                              BorderThickness="0,0,0,1"
                              BorderBrush="#F0F0F0"
                              Padding="12,12"
                              HorizontalAlignment="Stretch"
                              HorizontalContentAlignment="Stretch"
                              Command="{Binding $parent[ItemsControl].((vm:AttendedWeighingViewModel)DataContext).SelectRecordCommand}"
                              CommandParameter="{Binding}">
                        <Grid ColumnDefinitions="80,*,*">
                          <TextBlock Text="{Binding PlateNumber, TargetNullValue='未识别'}" 
                                     FontSize="13"
                                     Foreground="#333"/>
                          <TextBlock Grid.Column="1" 
                                     Text="{Binding CreationTime, StringFormat='{}{0:MM-dd HH:mm}'}" 
                                     FontSize="13"
                                     Foreground="#666"/>
                          <TextBlock Grid.Column="2" 
                                     Text="-" 
                                     FontSize="13"
                                     Foreground="#666"/>
                        </Grid>
                      </Button>
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>
              </ScrollViewer>
              
              <!-- Scrollable List - Completed Waybills -->
              <ScrollViewer Grid.Row="1" IsVisible="{Binding IsShowCompleted}">
                <ItemsControl ItemsSource="{Binding PagedCompletedWaybills}">
                  <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="entities:Waybill">
                      <Button Background="Transparent"
                              BorderThickness="0,0,0,1"
                              BorderBrush="#F0F0F0"
                              Padding="12,12"
                              HorizontalAlignment="Stretch"
                              HorizontalContentAlignment="Stretch"
                              Command="{Binding $parent[ItemsControl].((vm:AttendedWeighingViewModel)DataContext).SelectRecordCommand}"
                              CommandParameter="{Binding}">
                        <Grid ColumnDefinitions="80,*,*">
                          <TextBlock Text="{Binding PlateNumber, TargetNullValue='未识别'}" 
                                     FontSize="13"
                                     Foreground="#333"/>
                          <TextBlock Grid.Column="1" 
                                     Text="{Binding JoinTime, StringFormat='{}{0:MM-dd HH:mm}'}" 
                                     FontSize="13"
                                     Foreground="#666"/>
                          <TextBlock Grid.Column="2" 
                                     Text="{Binding OutTime, StringFormat='{}{0:MM-dd HH:mm}'}" 
                                     FontSize="13"
                                     Foreground="#666"/>
                        </Grid>
                      </Button>
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>
              </ScrollViewer>

              <!-- 全部记录模式下的混合列表 -->
              <ScrollViewer Grid.Row="1" IsVisible="{Binding IsShowAllRecords}">
                <StackPanel>
                  <!-- 未完成记录 -->
                  <ItemsControl ItemsSource="{Binding PagedUnmatchedWeighingRecords}">
                    <ItemsControl.ItemTemplate>
                      <DataTemplate x:DataType="entities:WeighingRecord">
                        <Button Background="Transparent"
                                BorderThickness="0,0,0,1"
                                BorderBrush="#F0F0F0"
                                Padding="12,12"
                                HorizontalAlignment="Stretch"
                                HorizontalContentAlignment="Stretch"
                                Command="{Binding $parent[ItemsControl].((vm:AttendedWeighingViewModel)DataContext).SelectRecordCommand}"
                                CommandParameter="{Binding}">
                          <Grid ColumnDefinitions="80,*,*">
                            <TextBlock Text="{Binding PlateNumber, TargetNullValue='未识别'}" 
                                       FontSize="13"
                                       Foreground="#333"/>
                            <TextBlock Grid.Column="1" 
                                       Text="{Binding CreationTime, StringFormat='{}{0:MM-dd HH:mm}'}" 
                                       FontSize="13"
                                       Foreground="#666"/>
                            <TextBlock Grid.Column="2" 
                                       Text="-" 
                                       FontSize="13"
                                       Foreground="#666"/>
                          </Grid>
                        </Button>
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>
                  <!-- 已完成记录 -->
                  <ItemsControl ItemsSource="{Binding PagedCompletedWaybills}">
                    <ItemsControl.ItemTemplate>
                      <DataTemplate x:DataType="entities:Waybill">
                        <Button Background="Transparent"
                                BorderThickness="0,0,0,1"
                                BorderBrush="#F0F0F0"
                                Padding="12,12"
                                HorizontalAlignment="Stretch"
                                HorizontalContentAlignment="Stretch"
                                Command="{Binding $parent[ItemsControl].((vm:AttendedWeighingViewModel)DataContext).SelectRecordCommand}"
                                CommandParameter="{Binding}">
                          <Grid ColumnDefinitions="80,*,*">
                            <TextBlock Text="{Binding PlateNumber, TargetNullValue='未识别'}" 
                                       FontSize="13"
                                       Foreground="#333"/>
                            <TextBlock Grid.Column="1" 
                                       Text="{Binding JoinTime, StringFormat='{}{0:MM-dd HH:mm}'}" 
                                       FontSize="13"
                                       Foreground="#666"/>
                            <TextBlock Grid.Column="2" 
                                       Text="{Binding OutTime, StringFormat='{}{0:MM-dd HH:mm}'}" 
                                       FontSize="13"
                                       Foreground="#666"/>
                          </Grid>
                        </Button>
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>
                </StackPanel>
              </ScrollViewer>
              
              <!-- Pagination Controls -->
              <Border Grid.Row="2" 
                      Background="#F8F9FA" 
                      BorderBrush="#E5E7EB" 
                      BorderThickness="0,1,0,0"
                      Padding="12,8">
                <Grid ColumnDefinitions="Auto,*,Auto,Auto">
                  <!-- 总记录数信息 -->
                  <TextBlock Grid.Column="0"
                             Text="{Binding TotalCount, StringFormat='共 {0} 条'}"
                             FontSize="12"
                             Foreground="#666"
                             VerticalAlignment="Center"
                             Margin="0,0,12,0"/>
                  
                  <!-- 页码信息 -->
                  <TextBlock Grid.Column="1"
                             HorizontalAlignment="Center"
                             VerticalAlignment="Center"
                             Text="{Binding PageInfoText}"
                             FontSize="12"
                             Foreground="#666"/>
                  
                  <!-- 上一页按钮 -->
                  <Button Grid.Column="2"
                          Content="上一页"
                          Command="{Binding GoToPreviousPageCommand}"
                          Background="White"
                          Foreground="#4169E1"
                          BorderBrush="#E5E7EB"
                          BorderThickness="1"
                          CornerRadius="4"
                          Padding="12,6"
                          FontSize="12"
                          Margin="0,0,8,0"/>
                  
                  <!-- 下一页按钮 -->
                  <Button Grid.Column="3"
                          Content="下一页"
                          Command="{Binding GoToNextPageCommand}"
                          Background="White"
                          Foreground="#4169E1"
                          BorderBrush="#E5E7EB"
                          BorderThickness="1"
                          CornerRadius="4"
                          Padding="12,6"
                          FontSize="12"/>
                </Grid>
              </Border>
            </Grid>
          </Border>
        </Grid>
      </Border>

      <!-- Middle Column: Material Info and Photos -->
      <views:AttendedWeighingMainView Grid.Column="1" DataContext="{Binding}"/>

      <!-- Right Column: Camera Views and Bill -->
      <Border Grid.Column="2" 
              Background="#F8F9FA" 
              BorderBrush="#E5E7EB" 
              BorderThickness="1,0,0,0"
              Padding="20">
        <Grid RowDefinitions="Auto,Auto,Auto,Auto,*,Auto">
          <!-- Camera Tabs -->
          <Border Background="White" 
                  CornerRadius="8,8,0,0" 
                  BorderBrush="#E5E7EB" 
                  BorderThickness="1,1,1,0">
            <UniformGrid Rows="1" Columns="2">
              <Button Content="进场照片" 
                      Background="#4169E1"
                      Foreground="White"
                      BorderThickness="0"
                      CornerRadius="8,0,0,0"
                      Padding="32,12"
                      FontSize="14"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Center"/>
              <Button Content="出场照片" 
                      Background="White"
                      Foreground="#666"
                      BorderThickness="0"
                      CornerRadius="0,8,0,0"
                      Padding="32,12"
                      FontSize="14"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Center"/>
            </UniformGrid>
          </Border>
          
          <!-- Camera Grid -->
          <Border Grid.Row="1" 
                  Background="White" 
                  BorderBrush="#E5E7EB" 
                  BorderThickness="1,0,1,1"
                  CornerRadius="0,0,8,8"
                  Padding="16"
                  Height="280">
            <Grid RowDefinitions="*,*" 
                  ColumnDefinitions="*,*"
                  RowSpacing="8"
                  ColumnSpacing="8">
              <Border Background="#E5E7EB" CornerRadius="4">
                <Image Source="{Binding CurrentEntryPhoto1}" Stretch="UniformToFill"/>
              </Border>
              <Border Grid.Column="1" Background="#E5E7EB" CornerRadius="4">
                <Image Source="{Binding CurrentEntryPhoto2}" Stretch="UniformToFill"/>
              </Border>
              <Border Grid.Row="1" Background="#E5E7EB" CornerRadius="4">
                <Image Source="{Binding CurrentEntryPhoto3}" Stretch="UniformToFill"/>
              </Border>
              <Border Grid.Row="1" Grid.Column="1" Background="#E5E7EB" CornerRadius="4">
                <Image Source="{Binding CurrentEntryPhoto4}" Stretch="UniformToFill"/>
              </Border>
            </Grid>
          </Border>
          
          <!-- Bill Scan Section -->
          <TextBlock Grid.Row="2" 
                     Text="单据扫描" 
                     FontSize="14" 
                     FontWeight="SemiBold"
                     Margin="0,24,0,12"/>
          
          <Border Grid.Row="3" 
                  Background="White" 
                  BorderBrush="#E5E7EB" 
                  BorderThickness="1"
                  CornerRadius="8"
                  Height="240"
                  Padding="16">
            <Grid RowDefinitions="*,Auto">
              <Border Background="#F0F0F0" 
                      CornerRadius="4"
                      BorderBrush="#D1D5DB"
                      BorderThickness="1">
                <Image Source="{Binding BillPhotoPath}" 
                       Stretch="Uniform"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"/>
              </Border>
              
              <Button Grid.Row="1" 
                      Content="拍照" 
                      Background="#20C9A6"
                      Foreground="White"
                      BorderThickness="0"
                      CornerRadius="6"
                      Padding="48,8"
                      HorizontalAlignment="Center"
                      Margin="0,12,0,0"
                      Command="{Binding TakeBillPhotoCommand}"/>
            </Grid>
          </Border>
        </Grid>
      </Border>
      
    </Grid>
    
    <!-- Status Bar -->
    <Border Grid.Row="3" 
            Background="#F5F5F5" 
            BorderBrush="#E5E7EB" 
            BorderThickness="0,1,0,0"
            Padding="16,8">
      <Grid ColumnDefinitions="Auto,Auto,Auto,*,Auto">
        <!-- Test Button -->
        <Button Grid.Column="0"
                Content="测试详情窗口"
                Background="#4169E1"
                Foreground="White"
                BorderThickness="0"
                CornerRadius="4"
                Padding="16,8"
                FontSize="13"
                Margin="0,0,16,0"
                Click="TestDetailWindow_Click"/>
        
        <!-- Scale Status Indicator -->
        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
          <!-- Online Indicator -->
          <Ellipse Width="10" Height="10" VerticalAlignment="Center" IsVisible="{Binding IsScaleOnline}">
            <Ellipse.Fill>
              <SolidColorBrush Color="#10B981"/>
            </Ellipse.Fill>
          </Ellipse>
          <!-- Offline Indicator -->
          <Ellipse Width="10" Height="10" VerticalAlignment="Center" IsVisible="{Binding !IsScaleOnline}">
            <Ellipse.Fill>
              <SolidColorBrush Color="#EF4444"/>
            </Ellipse.Fill>
          </Ellipse>
          <TextBlock Text="地磅设备" 
                     FontSize="13" 
                     Foreground="#666"
                     VerticalAlignment="Center"/>
          <!-- Online Status Text -->
          <TextBlock Text="在线" 
                     FontSize="13" 
                     Foreground="#10B981"
                     VerticalAlignment="Center"
                     FontWeight="SemiBold"
                     IsVisible="{Binding IsScaleOnline}"/>
          <!-- Offline Status Text -->
          <TextBlock Text="离线" 
                     FontSize="13" 
                     Foreground="#EF4444"
                     VerticalAlignment="Center"
                     FontWeight="SemiBold"
                     IsVisible="{Binding !IsScaleOnline}"/>
        </StackPanel>
        
        <!-- Camera Status Indicator -->
        <Grid Grid.Column="2" 
              Margin="24,0,0,0"
              VerticalAlignment="Center">
          <StackPanel Orientation="Horizontal" 
                      Spacing="8" 
                      VerticalAlignment="Center"
                      Name="CameraStatusPanel"
                      PointerEntered="CameraStatusPanel_OnPointerEntered"
                      PointerExited="CameraStatusPanel_OnPointerExited">
            <!-- Online Indicator -->
            <Ellipse Width="10" Height="10" VerticalAlignment="Center" IsVisible="{Binding IsCameraOnline}">
              <Ellipse.Fill>
                <SolidColorBrush Color="#10B981"/>
              </Ellipse.Fill>
            </Ellipse>
            <!-- Offline Indicator -->
            <Ellipse Width="10" Height="10" VerticalAlignment="Center" IsVisible="{Binding !IsCameraOnline}">
              <Ellipse.Fill>
                <SolidColorBrush Color="#EF4444"/>
              </Ellipse.Fill>
            </Ellipse>
            <TextBlock Text="摄像头" 
                       FontSize="13" 
                       Foreground="#666"
                       VerticalAlignment="Center"/>
            <!-- Online Status Text -->
            <TextBlock Text="在线" 
                       FontSize="13" 
                       Foreground="#10B981"
                       VerticalAlignment="Center"
                       FontWeight="SemiBold"
                       IsVisible="{Binding IsCameraOnline}"/>
            <!-- Offline Status Text -->
            <TextBlock Text="离线" 
                       FontSize="13" 
                       Foreground="#EF4444"
                       VerticalAlignment="Center"
                       FontWeight="SemiBold"
                       IsVisible="{Binding !IsCameraOnline}"/>
          </StackPanel>
          
          <!-- Camera Status Popup -->
          <Popup Name="CameraStatusPopup"
                 PlacementMode="Bottom"
                 IsLightDismissEnabled="False"
                 HorizontalOffset="0"
                 VerticalOffset="2"
                 PointerEntered="CameraStatusPopup_OnPointerEntered"
                 PointerExited="CameraStatusPopup_OnPointerExited">
            <views:CameraStatusPopup DataContext="{Binding}"/>
          </Popup>
        </Grid>
        
        <!-- Right side info (can be extended later) -->
        <TextBlock Grid.Column="4" 
                   Text="{Binding CurrentTime, StringFormat='{}{0:yyyy-MM-dd HH:mm:ss}'}" 
                   FontSize="12" 
                   Foreground="#999"
                   VerticalAlignment="Center"/>
      </Grid>
    </Border>
  </Grid>
</Window>
