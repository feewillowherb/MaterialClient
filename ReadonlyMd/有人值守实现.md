有人值守功能实现





## 为Avalonia添加一个Abp的Host，并支持Abp模块注册。

1. 为Avalonia添加一个Abp的Host，最小功能的Abp HttpHost,需要支持Swagger。不需要Auth等其他不需要的额外内容。
2. 为Avalonia添加Abp的AutofacServiceFactory















## 根据已存在的main_ui.png、main_ui2.png和MainWindows.xaml绘制页面有人值守.xaml

1. 参考main_ui.png、main_ui2.png、order_list.png、order_detail.png、join_out_camaer.png、bill.png和MainWindows.xaml绘制有人值守页面。
2. MainWindows.xaml存在大量合理里的布局错误。不要沿用。迁移要使用规范布局。严格准许Avalonia UI原则。
3. order_list.png包含WeighingRecord和Waybill，未完成表示WeighingRecord.WeighingRecordType == Unmatch，已完成的为Waybill，点击后会显示对应的order_detail.png
4. order_detail.png 是WeighingRecord或Waybill,如果是WeighingRecord。默认显示为毛重和进场时间、其他为空
5. join_out_camera.png 为车辆拍照展示界面
6. bill.png 为票据照片展示界面



## 添加称重逻辑（需要完成集成测试）

1. 添加一个WeightOffsetRange的json配置。默认值为1decimal到-1decimal。再添加一个WeightStableDuration配置稳定时间默认为2000ms，WeighingMatchDuration可以配时间默认为3h.
2. 地磅设备(TruckScaleWeight)有三种状态，地磅默认是OffScale状态。
   1. （车辆驶入TruckScaleWeight从WeightOffsetRange增长）TruckScaleWeight从WeightOffsetRange值增长（状态变为已上称）并稳定在大于WeightOffsetRange值时，稳定时间为WeightStableDuration，视为称重成功，（状态变为称重完成）创建对应的WeighingRecord并持久化。
      然后车辆驶离，TruckScaleWeight变为WeightOffsetRange。状态变为OffScale
   2. 当TruckScaleWeight从WeightOffsetRange值增长并没有稳定WeightStableDuration时间直接回到WeightOffsetRange。是为称重失败。生成日志。并不记录WeighingRecord。
3. 创建WeighingRecord时，Provider和Material。PlateNumber从车牌抓拍接口获取，可为空，允许任意字符串。还需要调用拍照并持久化WeighingRecordAttachment
4. 为WeighingRecord新增字段需要能够表示WeighingRecord是否已经被匹配。该WeighingRecord被匹配时是join还是out
   1. 匹配规则1，两个WeighingRecord车牌相同，且两个WeighingRecord的创建时间间隔在WeighingMatchDuration之内。
   2. 匹配规则2，WeighingRecordJoin创建时间必须小于WeighingRecordOut。当当前页面设置DeliveryType为收料时，WeighingRecordJoin.Weight必须大于WeighingRecordOut.Weight。当当前页面设置DeliveryType为发料时，WeighingRecordJoin.Weight必须小于WeighingRecordOut.Weight
   3. 匹配成功后将使用WeighingRecordJoin和WeighingRecordOut数据创建WayBill，OrderNo为GuidToString(),Waybill的Provider和Material取Join和Out任意不为空的数据。Waybill的ProviderId和MaterialId都可为空。创建Waybill时，遇到无法获取数据源的字段给个默认值加TODO注释。票据拍照可以为空，用户可以不拍票据





```
public enum VehicleWeightStatus
{
    /// <summary>
    /// 已下称
    /// </summary>
    OffScale = 0,

    /// <summary>
    /// 已上称
    /// </summary>
    OnScale = 1,

    /// <summary>
    /// 称重完成
    /// </summary>
    Weighing = 2
    
}

public enum DeliveryType

{
发料 = 0,
收料 = 1

}


//WeighingRecord新增这个字段
public enum WeighingRecordType
{
	Unmatch = 0,
	Join = 1,
	Out = 2
}


public enum OrderType
{
有人值守 = 0
}
```



## 实现硬件接口，实现内容返回固定值。

总共有四种硬件接口，当前接口都返回固定值。并添加备注“待对接设备”。

当前是设备未对接阶段，所以硬件接口都返回固定数据。

1. 获取地磅重量接口，该接口只返回一个decimal的值，需要实现一个http接口，该接口可以修改该返回值。用于User手动测试用
2. 车牌抓拍，该抓拍接口会返回车辆号码的字符串（当前阶段不需要对其进行有效车牌验证）。需要实现一个http接口，该接口可以修改该返回值。用于User手动测试用
3. 车辆拍照，该接口会返回一组照片。返回固定4张相同的jpg格式照片。测试图片在"https://fastly.picsum.photos/id/201/500/300.jpg?hmac=v0GEqa-YATYYy9hkxWbMmoxVAp_JtNKUSpkfKBtwuBE"
4. 票据拍照，该接口会返回一张图片，测试图片在"https://fastly.picsum.photos/id/201/500/300.jpg?hmac=v0GEqa-YATYYy9hkxWbMmoxVAp_JtNKUSpkfKBtwuBE"