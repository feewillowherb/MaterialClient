openapi: 3.0.3
info:
  title: 基础平台 API
  description: |-
    MaterialClient 称重管理系统使用的基础平台授权和认证接口。
    
    该API提供：
    - 软件授权验证
    - 用户登录认证
    
  version: 1.0.0
  contact:
    name: MaterialClient Team
    
servers:
  - url: http://base.publicapi.findong.com
    description: 生产环境
  - url: http://test-base.publicapi.findong.com
    description: 测试环境

tags:
  - name: 授权管理
    description: 软件授权验证相关接口
  - name: 用户认证
    description: 用户登录和身份验证接口

paths:
  /api/AuthClientLicense/GetAuthClientLicense:
    post:
      tags:
        - 授权管理
      summary: 获取授权客户端许可证
      description: |-
        验证用户输入的授权码，返回授权信息。
        
        **业务规则：**
        - ProductCode 固定为 "5000"（称重管理系统产品代码）
        - 授权码与机器码绑定，防止非法转移
        - 授权信息包含项目ID、Token、到期时间
        
      operationId: getAuthClientLicense
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LicenseRequest'
            examples:
              validRequest:
                summary: 有效请求示例
                value:
                  productCode: "5000"
                  code: "1234567890abcdef"
      responses:
        '200':
          description: 授权验证成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LicenseInfoResponse'
              examples:
                success:
                  summary: 授权验证成功
                  value:
                    code: 0
                    success: true
                    msg: "操作成功"
                    data:
                      proid: "3fa85f64-5717-4562-b3fc-2c963f66afa6"
                      authToken: "7c9e6679-7425-40de-944b-e07fc1f90ae7"
                      authEndTime: "2026-11-07T00:00:00Z"
                      machineCode: "ABC123XYZ789"
                invalidCode:
                  summary: 授权码无效
                  value:
                    code: 401
                    success: false
                    msg: "授权码无效"
                    data: null
                expiredCode:
                  summary: 授权已过期
                  value:
                    code: 402
                    success: false
                    msg: "授权已过期"
                    data: null
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 服务器内部错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /User/UserLogin:
    post:
      tags:
        - 用户认证
      summary: 用户登录
      description: |-
        用户通过用户名（手机号）和密码登录系统。
        
        **业务规则：**
        - UserName 必须是手机号格式
        - ProId 必须是有效的项目ID（来自授权信息）
        - 登录成功返回用户信息和Token
        - Token用于后续API调用的身份验证
        
      operationId: userLogin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            examples:
              validLogin:
                summary: 有效登录请求
                value:
                  userName: "13800138000"
                  userPwd: "password123"
                  proId: "3fa85f64-5717-4562-b3fc-2c963f66afa6"
      responses:
        '200':
          description: 登录成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginUserResponse'
              examples:
                success:
                  summary: 登录成功
                  value:
                    code: 0
                    success: true
                    msg: "登录成功"
                    data:
                      userId: 1001
                      userName: "13800138000"
                      clientId: "7c9e6679-7425-40de-944b-e07fc1f90ae7"
                      trueName: "张三"
                      isAdmin: true
                      isCompany: false
                      productType: 2
                      fromProductId: 1
                      productId: 5000
                      productName: "称重管理系统"
                      coId: 100
                      coName: "示例公司"
                      url: "https://example.com"
                      token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                      authEndTime: "2026-11-07T00:00:00Z"
                invalidCredentials:
                  summary: 用户名或密码错误
                  value:
                    code: 403
                    success: false
                    msg: "用户名或密码错误"
                    data: null
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 服务器内部错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    LicenseRequest:
      type: object
      required:
        - productCode
        - code
      properties:
        productCode:
          type: string
          description: 产品代码（固定为"5000"）
          example: "5000"
        code:
          type: string
          description: 用户输入的授权码
          example: "1234567890abcdef"
          
    LicenseInfo:
      type: object
      properties:
        proid:
          type: string
          format: uuid
          description: 项目ID
          example: "3fa85f64-5717-4562-b3fc-2c963f66afa6"
        authToken:
          type: string
          format: uuid
          nullable: true
          description: 授权Token
          example: "7c9e6679-7425-40de-944b-e07fc1f90ae7"
        authEndTime:
          type: string
          format: date-time
          description: 授权到期时间
          example: "2026-11-07T00:00:00Z"
        machineCode:
          type: string
          description: 机器码（用于硬件绑定）
          example: "ABC123XYZ789"
          
    LicenseInfoResponse:
      type: object
      properties:
        code:
          type: integer
          description: 状态码（0表示成功）
          example: 0
        success:
          type: boolean
          description: 是否成功
          example: true
        msg:
          type: string
          description: 响应消息
          example: "操作成功"
        data:
          $ref: '#/components/schemas/LicenseInfo'
          
    LoginRequest:
      type: object
      required:
        - userName
        - userPwd
        - proId
      properties:
        userName:
          type: string
          description: 用户名（手机号）
          example: "13800138000"
          pattern: '^1[3-9]\d{9}$'
        userPwd:
          type: string
          format: password
          description: 用户密码
          example: "password123"
        proId:
          type: string
          description: 项目ID（GUID字符串）
          example: "3fa85f64-5717-4562-b3fc-2c963f66afa6"
          
    LoginUser:
      type: object
      properties:
        userId:
          type: integer
          format: int64
          description: 用户ID
          example: 1001
        userName:
          type: string
          description: 用户名（手机号）
          example: "13800138000"
        clientId:
          type: string
          format: uuid
          description: 客户端标识
          example: "7c9e6679-7425-40de-944b-e07fc1f90ae7"
        trueName:
          type: string
          description: 真实姓名
          example: "张三"
        isAdmin:
          type: boolean
          description: 是否管理员
          example: true
        isCompany:
          type: boolean
          description: 是否企业
          example: false
        productType:
          type: integer
          description: 产品分类（1旧版本，2新版本）
          example: 2
        fromProductId:
          type: integer
          format: int64
          description: 来源产品ID
          example: 1
        productId:
          type: integer
          format: int64
          description: 产品ID
          example: 5000
        productName:
          type: string
          description: 产品名称
          example: "称重管理系统"
        coId:
          type: integer
          description: 公司ID
          example: 100
        coName:
          type: string
          description: 公司名称
          example: "示例公司"
        url:
          type: string
          format: uri
          description: 产品URL
          example: "https://example.com"
        token:
          type: string
          description: 登录Token（JWT）
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        authEndTime:
          type: string
          format: date-time
          nullable: true
          description: 授权到期时间
          example: "2026-11-07T00:00:00Z"
          
    LoginUserResponse:
      type: object
      properties:
        code:
          type: integer
          description: 状态码（0表示成功）
          example: 0
        success:
          type: boolean
          description: 是否成功
          example: true
        msg:
          type: string
          description: 响应消息
          example: "登录成功"
        data:
          $ref: '#/components/schemas/LoginUser'
          
    ErrorResponse:
      type: object
      properties:
        code:
          type: integer
          description: 错误码
          example: 500
        success:
          type: boolean
          description: 是否成功
          example: false
        msg:
          type: string
          description: 错误消息
          example: "服务器内部错误"
        data:
          type: object
          nullable: true
          description: 错误详细信息
          example: null

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |-
        使用登录接口返回的Token进行身份验证。
        
        **使用方法：**
        ```
        Authorization: Bearer {token}
        ```
        
# 注意：当前两个接口都不需要认证，但后续其他接口可能需要Token
security: []

